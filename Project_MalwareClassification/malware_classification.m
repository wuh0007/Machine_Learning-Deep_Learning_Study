%% Initialization
close all
clear all
clc 

%% Load Data
datapath = 'G:\Malware\train\';
files = dir([datapath,'*.bytes']);
filename = {files.name};

delimiter = {'\t',',',' ',';'};
start_idx = 1;
end_idx = inf;
formatspec = '%8s%3s%3s%3s%3s%3s%3s%3s%3s%3s%3s%3s%3s%3s%3s%3s%s%[^\n\r]';
 for i = 1:1
% for i = 1:length(files)
    i
    %read files
    file_ID = fopen([datapath,filename{i}]);
    %each line's 18 sets of content
    text_data = textscan(file_ID,formatspec,end_idx-1,...
                'Delimiter',delimiter,'EmptyValue',NaN,...
                'Headerline',0,'ReturnOnError',0);
    fclose(file_ID);
    %filter out heading and ending set
    for j = 2:length(text_data)-1
        text_data_2{j-1} = strtrim(text_data{j});
        size_array(j-1) = length(text_data_2{j-1});
    end
    min_size = min(size_array);
    decimal_data = zeros(min_size,length(text_data_2));
    
    for j = 1:length(text_data_2)
    text_data_2{j} = text_data_2{j}(1:min_size);%only take the min rows
    x = find(strcmp(text_data_2{j},'??'));%replace ?? to -1
    decimal_data(x,j) = -1;
    y = setdiff(1:min_size,x);
    decimal_data(y,j) = hex2dec(text_data_2{j}(y));%convert hex to dec
    end       
    dec=imresize(decimal_data,[256,16]); %resize dec to image
%     dec
%     imagesc(dec)
%     colormap('gray')
    all_images(i,:)=reshape(dec,[1,4096]);%save data
%     all_images(i,:)
    
end

%  save all_train_files all_images filename;
 